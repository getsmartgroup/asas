import { replaceAsync, feathersResultToArray, safeReplaceAsync } from './common';
export const wrapService = (service, _id = 'id') => {
    let index = {};
    const include = (data) => {
        feathersResultToArray(data).forEach(obj => {
            index[obj[_id]] = obj;
        });
        return data;
    };
    const exclude = (data) => {
        feathersResultToArray(data).forEach(obj => {
            if (index[obj[_id]]) {
                delete index[obj[_id]];
            }
        });
        return data;
    };
    service.get = replaceAsync(service.get.bind(service), include, undefined, undefined, undefined, id => {
        const cached = index[id];
        if (cached) {
            return cached;
        }
        return undefined;
    });
    service.find = safeReplaceAsync(service.find.bind(service), include);
    service.create = safeReplaceAsync(service.create.bind(service), include);
    service.update = safeReplaceAsync(service.update.bind(service), include);
    service.patch = safeReplaceAsync(service.patch.bind(service), include);
    service.remove = safeReplaceAsync(service.remove.bind(service), exclude);
    service.cache = index;
    service.getFromCache = (id) => index[id];
    return service;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VydmljZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvc2VydmljZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBUUEsT0FBTyxFQUFFLFlBQVksRUFBRSxxQkFBcUIsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQW9CaEYsTUFBTSxDQUFDLE1BQU0sV0FBVyxHQUFHLENBSzFCLE9BQW1CLEVBQ25CLE1BQVMsSUFBUyxFQUNkLEVBQUU7SUFDTixJQUFJLEtBQUssR0FBc0IsRUFBRSxDQUFBO0lBRWpDLE1BQU0sT0FBTyxHQUFHLENBQW1DLElBQU8sRUFBRSxFQUFFO1FBQzdELHFCQUFxQixDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUN6QyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFBO1FBQ3RCLENBQUMsQ0FBQyxDQUFBO1FBQ0YsT0FBTyxJQUFJLENBQUE7SUFDWixDQUFDLENBQUE7SUFDRCxNQUFNLE9BQU8sR0FBRyxDQUFtQyxJQUFPLEVBQUUsRUFBRTtRQUM3RCxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7WUFDekMsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7Z0JBQ3BCLE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO2FBQ3RCO1FBQ0YsQ0FBQyxDQUFDLENBQUE7UUFDRixPQUFPLElBQUksQ0FBQTtJQUNaLENBQUMsQ0FBQTtJQUVELE9BQU8sQ0FBQyxHQUFHLEdBQUcsWUFBWSxDQUN6QixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFDekIsT0FBTyxFQUNQLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNULEVBQUUsQ0FBQyxFQUFFO1FBQ0osTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBQ3hCLElBQUksTUFBTSxFQUFFO1lBQ1gsT0FBTyxNQUFNLENBQUE7U0FDYjtRQUNELE9BQU8sU0FBUyxDQUFBO0lBQ2pCLENBQUMsQ0FDRCxDQUFBO0lBQ0QsT0FBTyxDQUFDLElBQUksR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUNwRSxPQUFPLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBQ3hFLE9BQU8sQ0FBQyxNQUFNLEdBQUcsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUE7SUFDeEUsT0FBTyxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUN0RSxPQUFPLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0lBRXhFLE9BQU8sQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO0lBQ3JCLE9BQU8sQ0FBQyxZQUFZLEdBQUcsQ0FBQyxFQUFNLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUU1QyxPQUFPLE9BQVksQ0FBQTtBQUNwQixDQUFDLENBQUEifQ==